const sidebar=document.getElementById("sidebar"),backdrop=document.getElementById("sidebarBackdrop");let isSidebarOpen=!1;window.toggleSidebar=function(){isSidebarOpen=!isSidebarOpen;const e=document.getElementById("sidebar"),t=document.getElementById("sidebarBackdrop");isSidebarOpen?(e.classList.remove("-translate-x-full"),t.classList.remove("hidden"),setTimeout((()=>t.classList.remove("opacity-0")),10)):(e.classList.add("-translate-x-full"),t.classList.add("opacity-0"),setTimeout((()=>t.classList.add("hidden")),300))};let categoryChart=null;async function updateDashboard(e){let t;try{const e=(new Date).getTime(),a=await fetch(`js/data.json?v=${e}`);if(!a.ok)throw new Error("Network response was not ok");t=await a.json()}catch(e){return void console.error("Failed to fetch fresh data:",e)}const a=t[e];if(!a){console.error("No data found for periodKey:",e),document.getElementById("sisaVal").innerText="Rp 0",document.getElementById("terpakaiVal").innerText="Rp 0",document.getElementById("budgetVal").innerText="Rp 0";return}const n=document.getElementById("sisaVal"),r=document.getElementById("terpakaiVal"),i=document.getElementById("budgetVal"),s=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e).replace("Rp","Rp ");n&&(n.innerText=s(a.sisa)),r&&(r.innerText=s(a.totalSpent)),i&&(i.innerText=s(a.budget));const o=document.getElementById("terpakaiBadge");o&&(o.innerHTML=`<i class="ri-fire-fill"></i> ${a.percentSpent}% dari budget`);const d=document.getElementById("sisaBadge");if(d)if(a.sisa<=0){d.className="mt-4 flex items-center gap-2 text-xs font-medium text-danger bg-red-50 w-fit px-2 py-1 rounded-md",d.innerHTML='<i class="ri-alarm-warning-fill"></i> Over Budget!'}else if(a.sisa<2e5){d.className="mt-4 flex items-center gap-2 text-xs font-medium text-warning bg-yellow-50 w-fit px-2 py-1 rounded-md",d.innerHTML='<i class="ri-alert-fill"></i> Menipis'}else{d.className="mt-4 flex items-center gap-2 text-xs font-medium text-success bg-green-50 w-fit px-2 py-1 rounded-md",d.innerHTML='<i class="ri-thumb-up-fill"></i> Aman'}const l=a.categories||[],c=l.length>0?l[0].name:"Belum ada data";let m="",u="";const p=c,g=0===a.totalSpent||1===a.categories.length&&"Tabungan"===a.categories[0].name;a.sisa<=0?(m="Sisa budget Tuan sudah <strong>habis (Minus)</strong>. Mohon segera evaluasi pengeluaran. ğŸš¨",u=`Kategori <strong>${p}</strong> menyerap dana paling banyak. Stop pengeluaran non-essential. ğŸ›‘`):a.sisa<5e5?(m=`Sisa budget Tuan menipis (<strong>${s(a.sisa)}</strong>). Cukup untuk kebutuhan mendesak. ğŸ›¡ï¸`,u=`Pengeluaran <strong>${p}</strong> cukup tinggi. Masak di rumah bisa jadi solusi hemat! ğŸ³`):g?(m=`Periode baru dimulai! Saldo Tuan masih utuh (<strong>${s(a.sisa)}</strong>). âœ¨`,u="Belum ada pengeluaran signifikan. Saat yang tepat untuk menabung lebih awal! ğŸ’°"):(m=`Keuangan Tuan sehat! Sisa budget masih aman (<strong>${s(a.sisa)}</strong>). ğŸ¥‚`,"Makan"===p?u="Kategori <strong>Makan</strong> mendominasi. Coba kurangi jajan di luar minggu depan ya Tuan. ğŸ¥—":"Hiburan"===p?u="Wah, <strong>Hiburan</strong> jadi top pengeluaran. Ingat target tabungan nikah Tuan! ğŸ¬":"Tabungan"===p?u="Mantap! <strong>Tabungan</strong> jadi prioritas utama. Pertahankan disiplin ini Tuan! ğŸ’":u=`Pengeluaran terbesar di <strong>${p}</strong>. Pastikan tetap sesuai rencana anggaran ya. ğŸ“`);const h=(e,t)=>{const a=Array.from(document.querySelectorAll(".text-xs.font-bold.text-text-light")).find((t=>t.textContent.trim().toUpperCase()===e.toUpperCase()));a?a.nextElementSibling?a.nextElementSibling.innerHTML=t:console.warn("Found title but no sibling for:",e):console.warn("Could not find insight title element for:",e)};h("Status Mingguan",m),h("Saran Hemat",u);const f={Makan:"ri-restaurant-line",Hiburan:"ri-movie-line",Parkir:"ri-parking-box-line",Tabungan:"ri-bank-line",Transportasi:"ri-car-line",Belanja:"ri-shopping-bag-3-line",Tagihan:"ri-bill-line"},b={Makan:"blue",Hiburan:"green",Parkir:"yellow",Tabungan:"purple",Transportasi:"red",Belanja:"pink",Tagihan:"indigo"};let v="";0===l.length?v='<div class="p-3 text-center text-sm text-text-light">Belum ada transaksi.</div>':l.slice(0,5).forEach((e=>{const t=f[e.name]||"ri-bill-line",a=b[e.name]||"gray";v+=`\n            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">\n                <div class="flex items-center gap-3">\n                    <div class="w-8 h-8 rounded-full bg-${a}-100 text-${a}-600 flex items-center justify-center"><i class="${t}"></i></div>\n                    <span class="text-sm font-medium text-text-dark">${e.name}</span>\n                </div>\n                <span class="text-sm font-bold text-text-dark">${s(e.value)}</span>\n            </div>`}));const y=document.querySelector(".space-y-3");y&&(y.innerHTML=v),categoryChart&&(categoryChart.data.labels=l.map((e=>e.name)),categoryChart.data.datasets[0].data=l.map((e=>e.value)),categoryChart.update())}document.addEventListener("DOMContentLoaded",(async function(){try{const e=document.getElementById("periodSelect");if(e){e.addEventListener("change",(e=>{updateDashboard(e.target.value)})),updateDashboard(e.value)}else console.error("Dropdown element 'periodSelect' NOT found!");const t=document.getElementById("categoryChart");if(t)categoryChart=new Chart(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:["#3B82F6","#10B981","#F59E0B","#8B5CF6","#EF4444","#6B7280"],borderWidth:0,hoverOffset:15}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"75%",plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,pointStyle:"circle",padding:20,font:{family:"'Plus Jakarta Sans', sans-serif",size:12,weight:500},color:"#1F2937"}},tooltip:{backgroundColor:"#1F2937",padding:12,titleFont:{family:"'Plus Jakarta Sans', sans-serif",size:13},bodyFont:{family:"'Plus Jakarta Sans', sans-serif",size:13},cornerRadius:8,displayColors:!1,callbacks:{label:function(e){let t=e.label||"";return t&&(t+=": "),null!==e.parsed&&(t+=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e.parsed)),t}}}},animation:{animateScale:!0,animateRotate:!0}}})}catch(e){console.error("Failed to initialize dashboard:",e)}}));